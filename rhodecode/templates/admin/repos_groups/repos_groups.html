## -*- coding: utf-8 -*-
<%inherit file="/base/base.html"/>

<%def name="title()">
    ${_('Repository group')} - ${c.rhodecode_name}
</%def>


<%def name="breadcrumbs_links()">
    ${_('Group')} &raquo; ${c.group.group_name} - ${_(' %s repositories' % c.repo_cnt)} 
</%def>
<%def name="page_nav()">
    ${self.menu('admin')}
</%def>
<%def name="main()">
    <%def name="get_sort(name)">
        <%name_slug = name.lower().replace(' ','_') %>
        
        %if name_slug == c.sort_slug:
          %if c.sort_by.startswith('-'):
            <a href="?sort=${name_slug}">${name}&uarr;</a>
          %else:
            <a href="?sort=-${name_slug}">${name}&darr;</a>
          %endif:
        %else:
            <a href="?sort=${name_slug}">${name}</a>
        %endif
    </%def>
<div class="box">
    <!-- box / title -->
    <div class="title">
        ${self.breadcrumbs()}       
    </div>
    <!-- end box / title -->
        <div class="table">
            <table>
            <thead>
                <tr>
                    <th class="left">${get_sort(_('Name'))}</th>
                    <th class="left">${get_sort(_('Description'))}</th>
                    <th class="left">${get_sort(_('Last change'))}</th>
                    <th class="left">${get_sort(_('Tip'))}</th>
                    <th class="left">${get_sort(_('Owner'))}</th>
                    <th class="left">${_('RSS')}</th>
                    <th class="left">${_('Atom')}</th>
                </tr>
            </thead>
            <tbody>
            %for cnt,repo in enumerate(c.repos_list):
                <tr class="parity${cnt%2}">
                    <td>
                    <div style="white-space: nowrap">
                     ## TYPE OF REPO
                     %if repo['dbrepo']['repo_type'] =='hg':
                       <img class="icon" title="${_('Mercurial repository')}" alt="${_('Mercurial repository')}" src="${h.url("/images/icons/hgicon.png")}"/>
                     %elif repo['dbrepo']['repo_type'] =='git':
                       <img class="icon" title="${_('Git repository')}" alt="${_('Git repository')}" src="${h.url("/images/icons/giticon.png")}"/>
                     %else:
                       
                     %endif 
                    
                     ##PRIVATE/PUBLIC
                     %if repo['dbrepo']['private']:
                        <img class="icon" title="${_('private repository')}" alt="${_('private repository')}" src="${h.url("/images/icons/lock.png")}"/>
                     %else:
                        <img class="icon" title="${_('public repository')}" alt="${_('public repository')}" src="${h.url("/images/icons/lock_open.png")}"/>
                     %endif
                    
                    ##NAME   
                    ${h.link_to(repo['name'],
                        h.url('summary_home',repo_name=repo['name']),class_="repo_name")}
                    %if repo['dbrepo_fork']:
                        <a href="${h.url('summary_home',repo_name=repo['dbrepo_fork']['repo_name'])}">
                        <img class="icon" alt="${_('fork')}"
                        title="${_('Fork of')} ${repo['dbrepo_fork']['repo_name']}" 
                        src="${h.url("/images/icons/arrow_divide.png")}"/></a>
                    %endif
                    </div>
                    </td>
                    ##DESCRIPTION
                    <td><span class="tooltip" title="${h.tooltip(repo['description'])}">
                       ${h.truncate(repo['description'],60)}</span>
                    </td>
                    ##LAST CHANGE
                    <td>
                      <span class="tooltip" title="${repo['last_change']}">
                      ${h.age(repo['last_change'])}</span>
                    </td>
                    <td>
                        %if repo['rev']>=0:
                        ${h.link_to('r%s:%s' % (repo['rev'],h.short_id(repo['tip'])),
                        h.url('changeset_home',repo_name=repo['name'],revision=repo['tip']),
                        class_="tooltip",
                        title=h.tooltip(repo['last_msg']))}
                        %else:
                            ${_('No changesets yet')}
                        %endif    
                    </td>
                    <td title="${repo['contact']}">${h.person(repo['contact'])}</td>
                    <td>
                      %if c.rhodecode_user.username != 'default':
                        <a title="${_('Subscribe to %s rss feed')%repo['name']}" class="rss_icon"  href="${h.url('rss_feed_home',repo_name=repo['name'],api_key=c.rhodecode_user.api_key)}"></a>
                      %else:
                        <a title="${_('Subscribe to %s rss feed')%repo['name']}" class="rss_icon"  href="${h.url('rss_feed_home',repo_name=repo['name'])}"></a>
                      %endif:                       
                    </td>        
                    <td>
                      %if c.rhodecode_user.username != 'default':
                        <a title="${_('Subscribe to %s atom feed')%repo['name']}"  class="atom_icon" href="${h.url('atom_feed_home',repo_name=repo['name'],api_key=c.rhodecode_user.api_key)}"></a>
                      %else:
                        <a title="${_('Subscribe to %s atom feed')%repo['name']}"  class="atom_icon" href="${h.url('atom_feed_home',repo_name=repo['name'])}"></a>
                      %endif:
                    </td>
                </tr>
            %endfor
            </tbody>
            </table>
            </div>
</div> 
           
</%def>    
