## -*- coding: utf-8 -*-
<%inherit file="/base/base.html"/>

<%block name="title">
    ${_('My Notifications')} ${request.authuser.username}
</%block>

<%def name="breadcrumbs_links()">
    ${_('My Notifications')}
</%def>

<%block name="header_menu">
    ${self.menu('admin')}
</%block>

<%def name="main()">
<div class="panel panel-primary">
    <div class="panel-heading clearfix">
        ${self.breadcrumbs()}
    </div>

    <div class="panel-body">
      <div class="pull-left">
            <a class="btn btn-default btn-sm" href="${h.url.current()}">${_('All')}</a>
            <a class="btn btn-default btn-sm" href="${h.url.current(type=c.comment_type)}">${_('Comments')}</a>
            <a class="btn btn-default btn-sm" href="${h.url.current(type=c.pull_request_type)}">${_('Pull Requests')}</a>
      </div>
      %if c.notifications:
        <span id='mark_all_read' class="btn btn-default btn-sm pull-right">${_('Mark All Read')}</span>
      %endif
    </div>
    <div id="notification_data" class="panel-body">
        <%include file='notifications_data.html'/>
    </div>
</div>
<script type="text/javascript">
var url_delete = ${h.js(url('notification_delete', notification_id='__NOTIFICATION_ID__'))};
var url_read = ${h.js(url('notification_update', notification_id='__NOTIFICATION_ID__'))};
var run = function(){
  $('.delete-notification').click(function(e){
    var notification_id = e.currentTarget.id;
    deleteNotification(url_delete,notification_id);
  });
  $('.read-notification').click(function(e){
    var notification_id = e.currentTarget.id;
    readNotification(url_read,notification_id);
  });
}
run();
$('#mark_all_read').click(function(){
    var url = ${h.js(h.url('notifications_mark_all_read', **request.GET.mixed()))};
    asynchtml(url, $('#notification_data'), function(){run();});
});

var current_filter = ${h.js(c.current_filter)};
$('#'+current_filter).addClass('active');
</script>
</%def>
